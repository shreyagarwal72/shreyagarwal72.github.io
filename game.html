<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Games - Nextup Studio</title>
<style>
body {margin:0; padding:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background:#121212; color:white;}
.layout {display:flex; min-height:100vh;}
.sidebar {width:220px; background:#1c1c1c; padding:20px; box-sizing:border-box; position:fixed; height:100vh; overflow-y:auto; top:0; left:0; z-index:1000;}
.sidebar h2 {color:#00bcd4; text-align:center;}
.sidebar a {display:block; color:#00bcd4; padding:10px; text-decoration:none; margin-bottom:10px; border-radius:5px;}
.sidebar a.active, .sidebar a:hover {background:#0097a7; color:white; font-weight:bold;}
.main-content {margin-left:220px; padding:20px; flex-grow:1; box-sizing:border-box; text-align:center;}
button {background:#00bcd4; border:none; padding:12px 20px; border-radius:5px; margin:8px; cursor:pointer; font-weight:bold; color:#121212; font-size:16px;}
button:hover {background:#0097a7; color:white;}
#leaderboard {max-width:400px; margin:20px auto 0; background:#222; padding:15px; border-radius:10px; color:#00bcd4; text-align:left; display:none;}
#leaderboardList li {margin-bottom:5px;}
input[type="text"], input[type="number"] {padding:8px; border-radius:5px; border:none; font-size:16px; width:80%; margin-right:10px;}
#nameInputSection {margin-top:15px;}
@media(max-width:768px){
  .sidebar{width:100%; height:60px; position:fixed; top:0; left:0; display:flex; justify-content:center; align-items:center; flex-wrap:nowrap; overflow-x:auto; padding:0 10px; z-index:1000;}
  .sidebar h2{display:none;}
  .sidebar a{margin:0 8px; padding:8px 12px; font-size:14px; white-space:nowrap;}
  .main-content{margin-left:0; margin-top:60px; padding:10px;}
  input[type="text"], input[type="number"]{width:100%; margin-bottom:10px;}
}
</style>
</head>
<body>
<div class="layout">
  <div class="sidebar">
    <h2>Nextup Studio</h2>
    <a href="index.html">Home</a>
    <a href="yt.html">YouTube</a>
    <a href="journey.html">My Journey</a>
    <a href="game.html" class="active">Game</a>
  </div>
  <div class="main-content">
    <h1 id="gameTitle">Choose a Game to Play</h1>
    <div id="gameChoice">
      <p>Which game do you want to play?</p>
      <div id="gameButtons"></div>
      <hr style="margin:20px 0; border-color:#0097a7;" />
      <button id="showLeaderboardBtn">Show Leaderboard</button>
      <div id="leaderboard">
        <h3>Leaderboard - Top Scores</h3>
        <ol id="leaderboardList"></ol>
        <button id="closeLeaderboardBtn">Close Leaderboard</button>
      </div>
    </div>
    <div id="gameContainer"></div>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit } from "https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyBeuHiO0dUrG54Or-VsaHyo8lytjbKZZIA",
  authDomain: "nextup-studio.firebaseapp.com",
  projectId: "nextup-studio",
  storageBucket: "nextup-studio.firebasestorage.app",
  messagingSenderId: "87842391908",
  appId: "1:87842391908:web:04221d60a42689fa63dc71",
  measurementId: "G-WN67T528QY"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// --------- Global ---------
let currentUserName = JSON.parse(localStorage.getItem('nextupUser'))?.username || null;
let currentGame = "";

// --------- Game Data ---------
const quizData = [
  { question:"Minecraft mein Nether ka main portal kaise banate hain?", options:["Obsidian frame + Flint and Steel","Wooden frame + Torch","Stone frame + Pickaxe","Diamond frame + Fire Charge"], answer:"Obsidian frame + Flint and Steel"},
  { question:"AI ka full form kya hai?", options:["Artificial Intelligence","Automatic Input","Android Interface","Auto Identification"], answer:"Artificial Intelligence"},
  { question:"YouTube par sabse zyada subscribers wala channel kaun hai?", options:["T-Series","PewDiePie","Cocomelon","MrBeast"], answer:"MrBeast"},
  { question:"Squid Game mein guard ke mask par kaun sa shape hota hai?", options:["Circle","Triangle","Square","Star"], answer:"Triangle"},
  { question:"Minecraft mein Creeper kisse dur rehta hai?", options:["Cat","Wolf","Water","Lava"], answer:"Cat"}
];

// --------- Setup Buttons ---------
const games = ['quiz','hideSeek','ropeBridge','reactionTest'];
const gameNames = {'quiz':'Quiz Game','hideSeek':'Hide and Seek','ropeBridge':'Rope Bridge','reactionTest':'Reaction Time Test'};
const gameButtonsDiv = document.getElementById('gameButtons');
games.forEach(g=>{
  const btn = document.createElement('button');
  btn.textContent = gameNames[g];
  btn.addEventListener('click', ()=> loadGame(g));
  gameButtonsDiv.appendChild(btn);
});

// --------- Leaderboard Buttons ---------
document.getElementById('showLeaderboardBtn').addEventListener('click', showLeaderboard);
document.getElementById('closeLeaderboardBtn').addEventListener('click', hideLeaderboard);

// --------- Load Game ---------
function loadGame(game){
  currentGame = game;
  document.getElementById('leaderboard').style.display='none';
  document.getElementById('gameChoice').style.display='none';
  document.getElementById('gameContainer').style.display='block';
  document.getElementById('gameTitle').textContent = gameNames[game];
  if(game==='quiz') startQuiz();
  else if(game==='hideSeek') loadHideSeek();
  else if(game==='ropeBridge') loadRopeBridge();
  else if(game==='reactionTest') loadReactionTest();
}
function showGameChoice(){
  document.getElementById('gameChoice').style.display='block';
  document.getElementById('gameContainer').style.display='none';
  document.getElementById('gameTitle').textContent='Choose a Game to Play';
}

// --------- Quiz ---------
let currentQuestion=0, score=0;
function startQuiz(){ currentQuestion=0; score=0; renderQuizQuestion(); }
function renderQuizQuestion(){
  const container = document.getElementById('gameContainer');
  if(currentQuestion>=quizData.length){
    container.innerHTML=`<div style="max-width:600px;margin:auto;background:#1e1e1e;padding:20px;border-radius:10px;text-align:center;">
      <h2>Quiz Completed!</h2>
      <p>Your Score: <strong>${score}/${quizData.length}</strong></p>
      <button id="retryQuizBtn">Retry Quiz</button>
      <button id="backChoiceBtn">Back to Game Selection</button>
      <div id="nameInputSection" style="margin-top:15px;"></div>
    </div>`;
    document.getElementById('retryQuizBtn').addEventListener('click', startQuiz);
    document.getElementById('backChoiceBtn').addEventListener('click', showGameChoice);
    if(currentUserName){ saveScoreToFirestore(currentUserName, score, 'quiz'); }
    else askNameAndSaveScore(score,'quiz','nameInputSection');
    return;
  }
  const q = quizData[currentQuestion];
  container.innerHTML=`<div style="max-width:600px;margin:auto;background:#1e1e1e;padding:20px;border-radius:10px;text-align:left;">
    <h3>${q.question}</h3>
    <div id="quizOptions"></div>
  </div>`;
  const optionsDiv = document.getElementById('quizOptions');
  q.options.forEach(opt=>{
    const b = document.createElement('button');
    b.style.width='100%'; b.style.margin='5px 0';
    b.textContent = opt;
    b.addEventListener('click', ()=>{
      if(opt===q.answer) score++;
      currentQuestion++;
      renderQuizQuestion();
    });
    optionsDiv.appendChild(b);
  });
}

// --------- Hide & Seek ---------
function loadHideSeek(){
  const container = document.getElementById('gameContainer');
  container.innerHTML=`<div style="max-width:600px;margin:auto;background:#1e1e1e;padding:20px;border-radius:10px;text-align:center;">
    <p>Click the button to see if you got found!</p>
    <button id="hideSeekBtn">Check Hide Status</button>
    <p id="hideSeekResult" style="margin-top:15px;"></p>
    <div id="hideSeekNameInput" style="margin-top:15px;"></div>
    <button id="restartHideBtn" style="margin-top:15px;">Restart</button>
    <button id="backHideBtn" style="margin-top:15px;">Back to Game Selection</button>
  </div>`;
  document.getElementById('hideSeekBtn').addEventListener('click', ()=>{
    const found = Math.random()<0.5;
    const resultEl = document.getElementById('hideSeekResult');
    if(found){ resultEl.textContent='Oh no! You got found! ðŸ˜¢'; }
    else { resultEl.textContent='You are still hidden! ðŸŽ‰'; askNameAndSaveScore(1,'hideSeek','hideSeekNameInput'); }
  });
  document.getElementById('restartHideBtn').addEventListener('click', loadHideSeek);
  document.getElementById('backHideBtn').addEventListener('click', showGameChoice);
}

// --------- Rope Bridge ---------
function loadRopeBridge(){
  const container = document.getElementById('gameContainer');
  container.innerHTML=`<div style="max-width:600px;margin:auto;background:#1e1e1e;padding:20px;border-radius:10px;text-align:center;">
    <p>Guess a safe step number (1 to 5) to cross the bridge.</p>
    <input id="stepInput" type="number" min="1" max="5" placeholder="Step number"/>
    <button id="ropeBridgeBtn">Cross</button>
    <p id="ropeBridgeResult" style="margin-top:15px;"></p>
    <div id="ropeBridgeNameInput" style="margin-top:15px;"></div>
    <button id="restartRopeBtn" style="margin-top:15px;">Restart</button>
    <button id="backRopeBtn" style="margin-top:15px;">Back to Game Selection</button>
  </div>`;
  document.getElementById('ropeBridgeBtn').addEventListener('click', ()=>{
    const step = Number(document.getElementById('stepInput').value);
    const safeStep = Math.floor(Math.random()*5)+1;
    const resultEl = document.getElementById('ropeBridgeResult');
    if(step===safeStep){ resultEl.textContent='You crossed safely! ðŸŽ‰'; askNameAndSaveScore(1,'ropeBridge','ropeBridgeNameInput'); }
    else { resultEl.textContent='Oops! The bridge broke! You fell. ðŸ˜¢'; }
  });
  document.getElementById('restartRopeBtn').addEventListener('click', loadRopeBridge);
  document.getElementById('backRopeBtn').addEventListener('click', showGameChoice);
}

// --------- Reaction Test ---------
let reactionTimeout, reactionStart;
function loadReactionTest(){
  const container = document.getElementById('gameContainer');
  container.innerHTML=`<div style="max-width:600px;margin:auto;background:#1e1e1e;padding:20px;border-radius:10px;text-align:center;">
    <p>Wait for green, then click as fast as you can!</p>
    <button id="reactionBtn" disabled style="background:red;color:white;padding:20px;font-size:20px;border:none;border-radius:10px;cursor:not-allowed;">Wait for green...</button>
    <p id="reactionResult" style="margin-top:15px;"></p>
    <div id="reactionNameInput" style="margin-top:15px;"></div>
    <button id="startReactionBtn" style="margin-top:15px;">Start Test</button>
    <button id="backReactionBtn" style="margin-top:15px;">Back to Game Selection</button>
  </div>`;
  const btn=document.getElementById('reactionBtn');
  const result=document.getElementById('reactionResult');
  const startBtn=document.getElementById('startReactionBtn');
  startBtn.addEventListener('click', ()=>{
    btn.style.background='red'; btn.textContent='Wait for green...'; btn.disabled=true; btn.style.cursor='not-allowed';
    result.textContent='';
    reactionTimeout=setTimeout(()=>{
      btn.style.background='green'; btn.textContent='Click Now!'; btn.disabled=false; btn.style.cursor='pointer';
      reactionStart=performance.now();
      btn.addEventListener('click', function reactionClick(){
        const reactionTime=performance.now()-reactionStart;
        btn.style.background='#00bcd4'; btn.textContent=`Your reaction time: ${reactionTime.toFixed(2)} ms`;
        btn.disabled=true; btn.style.cursor='default';
        btn.removeEventListener('click', reactionClick);
        askNameAndSaveScore(Math.max(0,Math.round(3000-reactionTime)),'reactionTest','reactionNameInput');
      });
    }, Math.floor(Math.random()*3000)+2000);
    btn.addEventListener('click', function tooSoon(){
      clearTimeout(reactionTimeout);
      btn.style.background='red'; btn.textContent='Too Soon! Wait for green.'; btn.disabled=true; btn.style.cursor='default';
      btn.removeEventListener('click', tooSoon);
    });
  });
  document.getElementById('backReactionBtn').addEventListener('click', showGameChoice);
}

// --------- Leaderboard ---------
function saveScoreToFirestore(name, score, game){
  addDoc(collection(db,'leaderboard'), {name, score, game, timestamp: Date.now()});
}

async function showLeaderboard(){
  const leaderboardDiv=document.getElementById('leaderboard');
  const list=document.getElementById('leaderboardList');
  list.innerHTML='';
  const q = query(collection(db,'leaderboard'), orderBy('score','desc'), limit(10));
  const snapshot = await getDocs(q);
  if(snapshot.empty){ list.innerHTML='<li>No scores yet.</li>'; }
  else snapshot.forEach(doc=>{
    const li=document.createElement('li');
    const d = doc.data();
    li.textContent=`${d.name} - ${d.score} (${d.game})`;
    list.appendChild(li);
  });
  leaderboardDiv.style.display='block';
  document.getElementById('showLeaderboardBtn').style.display='none';
}
function hideLeaderboard(){
  document.getElementById('leaderboard').style.display='none';
  document.getElementById('showLeaderboardBtn').style.display='inline-block';
}

// --------- Ask Name & Save ---------
function askNameAndSaveScore(score, game, containerId){
  if(currentUserName){ saveScoreToFirestore(currentUserName, score, game); alert(`Score saved for ${currentUserName}`); return; }
  const container=document.getElementById(containerId);
  if(container.querySelector('input')) return;
  const input = document.createElement('input'); input.type='text'; input.placeholder='Enter your name'; input.id='playerNameInput';
  const btn = document.createElement('button'); btn.textContent='Save Score';
  btn.addEventListener('click', ()=>{
    const name = input.value.trim();
    if(!name){ alert('Enter name'); return; }
    saveScoreToFirestore(name, score, game);
    alert('Score saved! Check leaderboard.');
    container.innerHTML='';
  });
  container.appendChild(input);
  container.appendChild(btn);
}

// --------- Init ---------
document.addEventListener('DOMContentLoaded', ()=>{ document.getElementById('gameChoice').style.display='block'; });
</script>
</body>
</html>