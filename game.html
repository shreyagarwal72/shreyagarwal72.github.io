<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />  
  <meta name="viewport" content="width=device-width, initial-scale=1" />  
  <title>Games - Nextup Studio</title>  
  <link rel="stylesheet" href="style.css" />
  <style>
    body {
      margin:0; padding:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background:#121212; color:white;
      transition: background 0.2s, color 0.2s;
    }
    .layout { display: flex; min-height: 100vh; }
    .sidebar {
      width: 220px;
      background: #1e1e1e;
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
      gap: 15px;
      height: 100vh;
      position: relative;
    }
    .sidebar h2 {
      color: #00bcd4;
      margin-bottom: 20px;
      text-align: left;
      font-size: 22px;
      font-weight: 700;
      letter-spacing: 1px;
    }
    .sidebar a {
      color: #f0f0f0;
      text-decoration: none;
      padding: 10px;
      border-radius: 5px;
      font-weight: 500;
      margin-bottom: 6px;
      transition: background 0.2s, color 0.2s;
      display: block;
    }
    .sidebar a.active, .sidebar a:hover {
      background: #00bcd4;
      color: #181818;
      font-weight: bold;
    }
    .main-content {
      flex: 1;
      padding: 30px;
      margin-left: 0;
      box-sizing: border-box;
      text-align: center;
      /* No max-width, no margin: auto */
    }
    button {
      background: #00bcd4;
      border: none;
      padding: 12px 20px;
      border-radius: 5px;
      margin:8px 8px 8px 0;
      cursor: pointer;
      font-weight: bold;
      color: #121212;
      font-size: 16px;
      transition: background 0.3s, color 0.2s;
      display:inline-block;
    }
    button:hover {
      background: #0097a7;
      color: white;
    }
    #leaderboard {
      max-width: 400px;
      margin: 20px auto 0;
      background: #222;
      padding: 15px;
      border-radius: 10px;
      color: #00bcd4;
      text-align: left;
      display: none;
    }
    #leaderboardList li { margin-bottom: 5px; }
    input[type="text"], input[type="number"] {
      padding: 8px; border-radius: 5px; border: none;
      font-size: 16px; width:80%; margin-right:10px;
    }
    #nameInputSection { margin-top: 15px; }
    #gameCanvas {
      margin-top: 20px;
      border: 2px solid #00bcd4;
      border-radius: 10px;
      background: #232;
      touch-action: none;
      max-width: 100%;
      height: auto;
    }
    /* Responsive design */
    @media(max-width: 768px){
      .layout{flex-direction: column;}
      .sidebar{
        width:100%; height: 60px;
        padding:10px;
        flex-direction: row;
        justify-content: space-around;
        align-items:center;
        position:fixed; top:0; left:0; right:0;
        z-index:1000;
        gap: 0;
      }
      .sidebar h2{display:none;}
      .sidebar a{margin:0 8px; padding:8px 12px; font-size:14px; white-space:nowrap;}
      .main-content{margin-left:0; margin-top:60px; padding:10px;}
      input[type="text"], input[type="number"]{width:100%; margin-bottom:10px;}
      button {margin:8px 0;}
    }
    /* Light mode */
    body.light-mode { background:#f9f9f9; color:#222;}
    body.light-mode .sidebar{background:#e3f4fa;}
    body.light-mode .sidebar h2, body.light-mode .sidebar a { color:#0087a7; }
    body.light-mode .sidebar a.active,body.light-mode .sidebar a:hover {background:#00bcd4;color:#fff;}
    body.light-mode .main-content{background:#fff;color:#222;}
    body.light-mode #leaderboard{background:#daf1fc;color:#0087a7;}
  </style>
</head>
<body>
<div class="layout">
  <div class="sidebar">
    <h2>Nextup Studio</h2>
    <a href="index.html">Home</a>
    <a href="yt.html">YouTube</a>
    <a href="journey.html">My Journey</a>
    <a href="game.html" class="active">Game</a>
  </div>
  <div class="main-content">
    <h1 id="gameTitle">Choose a Game to Play</h1>
    <div id="gameChoice">
      <p>Which game do you want to play?</p>
      <button onclick="loadGame('quiz')">Quiz Game</button>
      <button onclick="loadGame('hideSeek')">Hide and Seek</button>
      <button onclick="loadGame('ropeBridge')">Rope Bridge</button>
      <button onclick="loadGame('reactionTest')">Reaction Time Test</button>
      <button onclick="loadGame('crossRoad')">Cross the Road</button>
      <hr style="margin:20px 0; border-color:#0097a7;" />
      <button id="showLeaderboardBtn" onclick="showLeaderboard()">Show Leaderboard</button>
      <div id="leaderboard">
        <h3>Leaderboard - Top Scores</h3>
        <ol id="leaderboardList"></ol>
        <button id="closeLeaderboardBtn" onclick="hideLeaderboard()">Close Leaderboard</button>
      </div>
    </div>
    <div id="gameContainer"></div>
  </div>
</div>

<script>
  // THEME SYNC (dark/light mode auto, no toggle)
  function setThemeFromStorage() {
    const themePref = localStorage.getItem('themeMode');
    if (themePref === 'light') document.body.classList.add('light-mode');
    else document.body.classList.remove('light-mode');
  }
  setThemeFromStorage();
  window.addEventListener('storage', function(e){
    if (e.key === 'themeMode') setThemeFromStorage();
  });

  // ---------------------- LOGIN SYNC ----------------------  
  let savedUserObj = JSON.parse(localStorage.getItem('nextupUser'));  
  let currentUserName = savedUserObj ? savedUserObj.username : null;  

  // ---------------------- QUIZ ----------------------  
  const quizData = [
    { question:"Minecraft mein Nether ka main portal kaise banate hain?", options:["Obsidian frame + Flint and Steel","Wooden frame + Torch","Stone frame + Pickaxe","Diamond frame + Fire Charge"], answer:"Obsidian frame + Flint and Steel"},
    { question:"AI ka full form kya hai?", options:["Artificial Intelligence","Automatic Input","Android Interface","Auto Identification"], answer:"Artificial Intelligence"},
    { question:"YouTube par sabse zyada subscribers wala channel kaun hai?", options:["T-Series","PewDiePie","Cocomelon","MrBeast"], answer:"MrBeast"},
    { question:"Squid Game mein guard ke mask par kaun sa shape hota hai?", options:["Circle","Triangle","Square","Star"], answer:"Triangle"},
    { question:"Minecraft mein Creeper kisse dur rehta hai?", options:["Cat","Wolf","Water","Lava"], answer:"Cat"}
  ];
  let currentQuestion=0, score=0;

  function loadGame(game){
    document.getElementById('leaderboard').style.display='none';
    document.getElementById('gameChoice').style.display='none';
    document.getElementById('gameContainer').style.display='block';
    document.getElementById('showLeaderboardBtn').style.display='inline-block';
    document.getElementById('gameTitle').textContent = {
      'quiz':'Quiz Game',
      'hideSeek':'Hide and Seek',
      'ropeBridge':'Rope Bridge',
      'reactionTest':'Reaction Time Test',
      'crossRoad':'Cross the Road'
    }[game];
    if(game==='quiz') startQuiz();
    else if(game==='hideSeek') loadHideSeek();
    else if(game==='ropeBridge') loadRopeBridge();
    else if(game==='reactionTest') loadReactionTest();
    else if(game==='crossRoad') loadCrossRoad();
  }

  function showGameChoice(){
    document.getElementById('gameChoice').style.display='block';
    document.getElementById('gameContainer').style.display='none';
    document.getElementById('gameTitle').textContent='Choose a Game to Play';
  }

  // --- Existing game functions here (startQuiz, loadHideSeek, etc.) ---

  // --- CROSS THE ROAD GAME ---
  function loadCrossRoad(){
    const container = document.getElementById('gameContainer');
    container.innerHTML = `
      <div style="max-width: 600px; margin: auto; color: white; text-align: center;">
        <p>Use arrow keys or on-screen buttons to cross the road safely!</p>
        <canvas id="gameCanvas"></canvas>
        <div style="margin-top: 10px;">
          <button id="upBtn">⬆️</button>
          <button id="leftBtn">⬅️</button>
          <button id="downBtn">⬇️</button>
          <button id="rightBtn">➡️</button>
        </div>
        <button style="margin-top: 20px;" onclick="showGameChoice()">Back to Game Selection</button>
      </div>
    `;

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    const GRID = 50;
    let rows, cols;
    let player;
    let obstacles = [];

    function resizeCanvas() {
      canvas.width = container.clientWidth * 0.95;
      canvas.height = canvas.width * 1.5; // 2:3 ratio approx
      rows = Math.floor(canvas.height / GRID);
      cols = Math.floor(canvas.width / GRID);
      restartGame();
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function restartGame(){
      player = { x: Math.floor(cols/2), y: rows-1, alive: true };
      obstacles = [];
      for(let r=0; r<rows-1; r++){
        let speed = Math.random() > 0.5 ? 0.8 : -0.8;
        let startX = speed > 0 ? -1 : cols;
        obstacles.push({ row: r, x: startX, speed, color: '#f33' });
      }
    }

    function drawGame(){
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      // Draw lanes
      for(let r=0; r<rows; r++){
        ctx.fillStyle = r % 2 === 0 ? '#484' : '#272';
        ctx.fillRect(0, r*GRID, canvas.width, GRID);
      }
      // Draw obstacles
      obstacles.forEach(ob => {
        ctx.fillStyle = ob.color;
        ctx.fillRect(ob.x * GRID, ob.row * GRID + 10, GRID - 10, GRID - 20);
      });
      // Draw player as circle
      ctx.beginPath();
      ctx.arc(player.x * GRID + GRID/2, player.y * GRID + GRID/2, GRID/2.2, 0, Math.PI*2);
      ctx.fillStyle = player.alive ? '#ff0' : '#888';
      ctx.fill();
    }

    function movePlayer(dx, dy){
      if(!player.alive) return;
      let nx = Math.max(0, Math.min(cols-1, player.x + dx));
      let ny = Math.max(0, Math.min(rows-1, player.y + dy));
      player.x = nx;
      player.y = ny;
      checkCollision();
      if(player.y === 0){
        setTimeout(() => {
          alert('You crossed safely! 🎉');
          askNameAndSaveScore(1, 'Cross the Road', null);
          restartGame();
        }, 100);
      }
    }

    function checkCollision(){
      obstacles.forEach(ob => {
        if(ob.row === player.y && Math.abs(ob.x - player.x) < 1){
          player.alive = false;
          setTimeout(() => {
            alert('You got hit! Game over.');
            restartGame();
          }, 300);
        }
      });
    }

    function updateObstacles(){
      obstacles.forEach(ob => {
        ob.x += ob.speed * 0.06;
        if((ob.speed > 0 && ob.x > cols) || (ob.speed < 0 && ob.x < -1)){
          ob.x = ob.speed > 0 ? -1 : cols;
        }
      });
    }

    function gameLoop(){
      if(canvas.width !== container.clientWidth * 0.95){
        resizeCanvas();
      }
      updateObstacles();
      drawGame();
      requestAnimationFrame(gameLoop);
    }
    gameLoop();

    // Controls keyboard
    document.addEventListener('keydown', e=>{
      if(e.key==='ArrowUp') movePlayer(0,-1);
      else if(e.key==='ArrowDown') movePlayer(0,1);
      else if(e.key==='ArrowLeft') movePlayer(-1,0);
      else if(e.key==='ArrowRight') movePlayer(1,0);
    });

    // Controls buttons touch
    document.getElementById('upBtn').onclick = () => movePlayer(0,-1);
    document.getElementById('downBtn').onclick = () => movePlayer(0,1);
    document.getElementById('leftBtn').onclick = () => movePlayer(-1,0);
    document.getElementById('rightBtn').onclick = () => movePlayer(1,0);
  }

  // --- LEADERBOARD AND SCORE FUNCTIONS (existing code) ---
  function saveScore(name, score, game){
    let scores=JSON.parse(localStorage.getItem('leaderboardScores'))||[];
    scores.push({name,score,game});
    scores.sort((a,b)=>b.score-a.score);
    if(scores.length>10) scores=scores.slice(0,10);
    localStorage.setItem('leaderboardScores',JSON.stringify(scores));
  }

  function showLeaderboard(){
    const leaderboardDiv=document.getElementById('leaderboard');
    const list=document.getElementById('leaderboardList');
    list.innerHTML='';
    let scores=JSON.parse(localStorage.getItem('leaderboardScores'))||[];
    if(scores.length===0){ list.innerHTML='<li>No scores yet.</li>'; }
    else{ scores.forEach(entry=>{ const li=document.createElement('li'); li.textContent=`${entry.name} - ${entry.score} (${entry.game})`; list.appendChild(li); }); }
    leaderboardDiv.style.display='block';
    document.getElementById('showLeaderboardBtn').style.display='none';
  }

  function hideLeaderboard(){
    document.getElementById('leaderboard').style.display='none';
    document.getElementById('showLeaderboardBtn').style.display='inline-block';
  }

  function askNameAndSaveScore(score, game, containerId){
    if(currentUserName){
      saveScore(currentUserName, score, game);
      alert(`Score saved automatically for ${currentUserName}!`);
      document.getElementById('showLeaderboardBtn').style.display='inline-block';
      return;
    }
    if(!containerId) return;
    const container=document.getElementById(containerId);
    if(container.querySelector('input')) return;
    container.innerHTML=`
      <input type="text" id="playerNameInput" placeholder="Enter your name"/>
      <button id="saveScoreBtn">Save Score</button>`;
    document.getElementById('saveScoreBtn').onclick=()=>{
      const name=document.getElementById('playerNameInput').value.trim();
      if(!name){ alert('Please enter your name'); return; }
      saveScore(name, score, game);
      alert('Score saved! Check leaderboard.');
      container.innerHTML='';
      document.getElementById('showLeaderboardBtn').style.display='inline-block';
    }
  }

  window.onload=()=>{ 
    showGameChoice(); 
    document.getElementById('showLeaderboardBtn').style.display='inline-block'; 
  }
</script>
</body>
</html>
